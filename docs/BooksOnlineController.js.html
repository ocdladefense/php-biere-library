<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: BooksOnlineController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: BooksOnlineController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import OregonLegislatureNetwork from "../node_modules/@ocdladefense/ors/dist/Network.js";
import { OrsParser } from "../node_modules/@ocdladefense/ors/dist/parser.js";
import { Modal } from "../node_modules/@ocdladefense/modal/dist/modal.js";

export {BooksOnlineController};

/**
 * Controller for the Books Online application.
 * Processes actions on behalf of the user.
 */
class BooksOnlineController {

    modal = null;


    constructor() {
        // Full-screen modal.
        this.modal = new Modal();
        window.modal = this.modal;
        OregonLegislatureNetwork.setUrl("includes/index.php");
    }

    /**
     * Handle user-actions.  These include requests to open
     * a modal with the text of the Oregon Revised Statutes (ORS) or
     * navigating to a specific ORS chapter/section.
     * @param {HTMLEventInterface} e The event that is being listened for.
     * @returns {boolean} false
     */
    handleEvent(e) {

        let target = e.target;
        let dataset = target.dataset;
        let action = dataset.action;
        let c = target.dataset.chapter;
        let s = target.dataset.section;

        if ("modal-backdrop" == target.id) {
            this.modal.hide();
        }

        if (!["view-section", "show-ors"].includes(action)) {
            return false;
        }

        e.preventDefault();
        // e.stopPropagation();

        if ("view-section" == action) {

            let marker = document.querySelector("#modal #section-" + s);
            marker.scrollIntoView({ behavior: "smooth", block: "start", inline: "nearest" });
            return false;
        }

        if ("show-ors" == action) {
            this.displayOrs(c, s);
            return false;
        }
    }

    /**
     * Load the specified chapter of Oregon Revised Statutes (ORS).
     * Display the chapter in a modal and scroll to the specified section.
     * @param {integer} c The ORS chapter to display.
     * @param {integer} s The ORS section to display.
     * @returns {boolean} false
     */
    async displayOrs(c, s) {

        let chapterNum = parseInt(c);
        let sectionNum = parseInt(s);

        let chapter = await OregonLegislatureNetwork.fetchOrs({chapter: chapterNum});

        // let vols = Ors.buildVolumes();
        let toc = chapter.buildToc();
        let html = chapter.toString();
        html = OrsParser.replaceAll(html);

        this.modal.show();
        this.modal.leftNav(toc);
        this.modal.html(html);
        this.modal.title("ORS Chapter " + chapterNum);
        let marker = document.querySelector("#modal #section-" + sectionNum);
        marker.scrollIntoView();
        // modal.titleBar(vols);


        return false;
    }


    /**
     * Replace references to Oregon Revised Statutes (ORS)
     * with inline links.
     * @param {CSSSelector} selector A valid CSS selector to pass to querySelector().
     */
    convert(selector) {
        var body = document.querySelector(selector);

        var text = body.innerHTML;
        var parsed = OrsParser.replaceAll(text);

        body.innerHTML = parsed;
    }

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BooksOnlineController.html">BooksOnlineController</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Jun 04 2023 18:42:26 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
